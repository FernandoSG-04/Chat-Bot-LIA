<!doctype html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>En vivo â€” Sesiones</title>
  <!-- TipografÃ­as (opcional). Fallback a Arial/Helvetica -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
  <style>
    /* ===== TOKENS (dark-first) ===== */
    :root{
      --bg:#0A0A0A; --bg-alt:#111; --surface:#0A0A0A; --surface-alt:#1A1A1A; --border:#262626;
      --text:#FFFFFF; --text-muted:#A3A3A3;
      --primary:#44E5FF; --primary-hover:#33CCFF;
      --link:#44E5FF; --focus:#44E5FF;
      --radius:12px; --space:16px;
      --shadow: 0 6px 16px rgba(0,0,0,.35);
    }
    [data-theme="light"]{
      --bg:#FFFFFF; --bg-alt:#F7F7F7; --surface:#FFFFFF; --surface-alt:#F2F2F2; --border:#E5E5E5;
      --text:#0A0A0A; --text-muted:#4D4D4D;
      --primary:#33CCFF; --primary-hover:#22B8E0;
      --link:#006B96; /* AA en claro */
      --focus:#006B96;
    }

    /* ===== Base ===== */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Inter", Arial, Helvetica, sans-serif;
      background:var(--bg); color:var(--text);
    }
    .wrap{max-width:1120px;margin:0 auto;padding:24px}
    .h1{font-family:"Montserrat", Arial, Helvetica, sans-serif;font-weight:800;font-size:34px;line-height:1.15;margin:0 0 12px;display:flex;gap:12px;align-items:center}
    .muted{color:var(--text-muted)}
    a{color:var(--link); text-decoration:underline}
    .toolbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:16px 0 24px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* Inputs */
    .input{
      height:44px; padding:0 12px; border:1px solid var(--border); background:var(--surface);
      color:var(--text); border-radius:10px; outline:none; width:100%;
    }
    .input::placeholder{color:var(--text-muted)}
    .input:focus-visible{outline:2px solid var(--focus); outline-offset:2px}

    /* Botones */
    .btn{
      display:inline-flex; align-items:center; gap:8px; height:44px;
      padding:0 14px; border-radius:10px; border:1px solid var(--border);
      background:var(--surface-alt); color:var(--text); text-decoration:none; cursor:pointer;
    }
    .btn:hover{filter:brightness(1.08)}
    .btn:focus-visible{outline:2px solid var(--focus); outline-offset:2px}
    .btn[disabled]{opacity:.4; cursor:not-allowed}

    .btn-primary{
      background:var(--primary); color:#0A0A0A; border-color:transparent; text-decoration:none;
    }
    .btn-primary:hover{background:var(--primary-hover)}

    /* Grid tarjetas */
    .grid{display:grid; gap:16px}
    @media (min-width:768px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media (min-width:1200px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr))} }

    .card{
      background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
      padding:16px; box-shadow:var(--shadow);
    }
    .card h3{
      font-family:"Montserrat", Arial, Helvetica, sans-serif; font-weight:700; font-size:18px; margin:0 0 4px;
    }
    .meta{font-size:14px}
    .actions{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}

    /* Dropdown accesible */
    .menu-wrap{position:relative; display:inline-block}
    .menu-btn{ /* botÃ³n que abre el menÃº */ }
    .menu{
      position:absolute; top:calc(100% + 6px); left:0; min-width:240px;
      background:var(--surface); border:1px solid var(--border); border-radius:10px;
      box-shadow:var(--shadow); padding:6px; display:none; z-index:10;
    }
    .menu[aria-hidden="false"]{display:block}
    .menu a, .menu button{
      display:block; width:100%; text-align:left; border:0; background:none; color:var(--text);
      padding:10px 12px; border-radius:8px; text-decoration:none; cursor:pointer; font-size:14px;
    }
    .menu a:hover, .menu button:hover, .menu a:focus-visible, .menu button:focus-visible{
      background:var(--surface-alt); outline:2px solid var(--focus); outline-offset:2px;
    }

    /* Header lÃ­nea separadora */
    .rule{height:1px;background:var(--border);margin:20px 0}
    /* Toggle tema (demo) */
    .toggle{border:1px solid var(--border); background:var(--surface-alt); border-radius:10px; height:44px;padding:0 12px;cursor:pointer}
    .toggle:focus-visible{outline:2px solid var(--focus); outline-offset:2px}
  </style>
</head>
<body>
  <main class="wrap" id="app">
    <header>
      <h1 class="h1">ðŸ“¡ En vivo</h1>
      <p class="muted">Sesiones en vivo del curso. Ãšnete y agrÃ©galas a tu calendario.</p>
    </header>

    <div class="toolbar">
      <div style="display:flex; gap:12px; align-items:center; width:100%; max-width:520px">
        <label class="sr-only" for="search">Buscar sesiÃ³n</label>
        <input class="input" id="search" type="search" placeholder="Buscar sesiÃ³nâ€¦" />
      </div>
      <div style="display:flex; gap:12px; align-items:center;">
        <label for="email" class="sr-only">Tu correo</label>
        <input id="email" class="input" style="width:260px" type="email" placeholder="Enviar por correo aâ€¦" />
        <button id="saveEmail" class="toggle" title="Guardar correo">Guardar correo</button>
        <button id="toggleTheme" class="toggle" title="Cambiar tema">Tema</button>
      </div>
    </div>

    <h2 style="font-size:24px; margin:0 0 8px;">Sesiones</h2>
    <div class="rule" role="presentation"></div>

    <section id="cards" class="grid" aria-live="polite"></section>
  </main>

  <script>
    /* ==============================
       Datos de ejemplo (ajÃºstalos)
       ============================== */
    const sessions = [
      {
        id: "s1",
        title: "SesiÃ³n 1",
        dateLabel: "Jul 23",
        startISO: "2024-10-10T10:00:00-05:00",
        endISO: "2024-10-10T13:00:00-05:00",
        durationMins: 180,
        meetingUrl: "https://example.com/meet/sesion1",
        location: "Online (Zoom)",
        timezone: "America/Mexico_City",
        description: "SesiÃ³n en vivo del curso de IA. Revisa audio/video antes de entrar."
      },
      {
        id: "s2",
        title: "SesiÃ³n 2",
        dateLabel: "Jul 24",
        startISO: "2024-10-15T10:00:00-05:00",
        endISO: "2024-10-15T13:00:00-05:00",
        durationMins: 180,
        meetingUrl: "https://example.com/meet/sesion2",
        location: "Online (Zoom)",
        timezone: "America/Mexico_City"
      },
      {
        id: "s3",
        title: "SesiÃ³n 3",
        dateLabel: "Jul 30",
        startISO: "2024-10-17T10:00:00-05:00",
        endISO: "2024-10-17T13:00:00-05:00",
        durationMins: 180,
        meetingUrl: "https://example.com/meet/sesion3",
        location: "Online (Zoom)",
        timezone: "America/Mexico_City"
      },
      {
        id: "s4",
        title: "SesiÃ³n 4",
        dateLabel: "Jul 31",
        startISO: "2024-10-22T10:00:00-05:00",
        endISO: "2024-10-22T13:00:00-05:00",
        durationMins: 180,
        meetingUrl: "https://example.com/meet/sesion4",
        location: "Online (Zoom)",
        timezone: "America/Mexico_City"
      }
    ];

    /* ========= Utilidades de fechas y URLs ========= */
    const pad = n => String(n).padStart(2, "0");
    function toUTC(dt){
      const y = dt.getUTCFullYear();
      const m = pad(dt.getUTCMonth()+1);
      const d = pad(dt.getUTCDate());
      const hh = pad(dt.getUTCHours());
      const mm = pad(dt.getUTCMinutes());
      const ss = pad(dt.getUTCSeconds());
      return `${y}${m}${d}T${hh}${mm}${ss}Z`;
    }
    function toISO(dt){ return dt.toISOString().replace(/\.\d{3}Z$/,"Z"); }
    const esc = s => encodeURIComponent(s||"");

    function googleCalendarUrl({title,start,end,tz,description,location}){
      const base = "https://calendar.google.com/calendar/render?action=TEMPLATE";
      return `${base}&text=${esc(title)}&dates=${toUTC(start)}/${toUTC(end)}&ctz=${esc(tz)}&details=${esc(description)}&location=${esc(location)}`;
    }
    function outlookUrl({title,start,end,description,location}){
      const base = "https://outlook.office.com/calendar/0/deeplink/compose?path=/calendar/action/compose&rru=addevent";
      return `${base}&startdt=${esc(toISO(start))}&enddt=${esc(toISO(end))}&subject=${esc(title)}&body=${esc(description)}&location=${esc(location)}`;
    }

    function buildICS({uid,title,start,end,description,location}){
      const now = new Date();
      const lines = [
        "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Ecos de liderazgo//LIA//ES",
        "CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",
        `UID:${uid}@lia`, `DTSTAMP:${toUTC(now)}`,
        `DTSTART:${toUTC(start)}`, `DTEND:${toUTC(end)}`,
        `SUMMARY:${title.replace(/\n/g," ")}`,
        description ? `DESCRIPTION:${description.replace(/\n/g,"\\n")}` : "",
        location ? `LOCATION:${location}` : "",
        "END:VEVENT","END:VCALENDAR"
      ].filter(Boolean).join("\r\n");
      return new Blob([lines],{type:"text/calendar;charset=utf-8"});
    }
    function downloadICS(blob, filename="evento"){
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = filename.endsWith(".ics")? filename : `${filename}.ics`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    function formatRange(start, tz){
      const d = new Intl.DateTimeFormat("es-MX", {weekday:"short",year:"numeric",month:"short",day:"2-digit", timeZone: tz}).format(start);
      const t1 = new Intl.DateTimeFormat("es-MX", {hour:"2-digit",minute:"2-digit", timeZone: tz}).format(start);
      return `${d} Â· ${t1} (${tz})`;
    }

    /* ========= Render ========= */
    const cards = document.getElementById("cards");
    const emailInput = document.getElementById("email");
    const savedEmail = localStorage.getItem("lia_user_email") || "";
    if(savedEmail){ emailInput.value = savedEmail; }

    function render(list){
      cards.innerHTML = "";
      list.forEach(s=>{
        const tz = s.timezone || "UTC";
        const start = new Date(s.startISO);
        const end = new Date(s.endISO);
        const subject = `${s.title} â€” En vivo`;
        const body = s.description || "SesiÃ³n en vivo del curso de IA. ConÃ©ctate puntualmente y verifica tu audio/video.";
        const gUrl = googleCalendarUrl({title:subject,start,end,tz,description:body,location:s.location});
        const oUrl = outlookUrl({title:subject,start,end,description:body,location:s.location});

        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <h3><a href="#" class="title" style="text-decoration:underline">${s.title}</a></h3>
          ${s.dateLabel ? `<div class="meta muted">${s.dateLabel}</div>`:""}
          <div class="meta" style="margin-top:2px">${formatRange(start, tz)} â€” ${s.durationMins} mins</div>
          <div class="actions">
            <a class="btn btn-primary" ${s.meetingUrl?`href="${s.meetingUrl}" target="_blank" rel="noreferrer"`:"aria-disabled='true'"}>ðŸŽ¥ Join Meeting</a>

            <div class="menu-wrap">
              <button class="btn menu-btn" aria-haspopup="menu" aria-expanded="false" aria-controls="menu-${s.id}">ðŸ“… Agregar a calendario</button>
              <div class="menu" id="menu-${s.id}" role="menu" aria-hidden="true">
                <a role="menuitem" href="${gUrl}" target="_blank" rel="noreferrer">Google Calendar</a>
                <a role="menuitem" href="${oUrl}" target="_blank" rel="noreferrer">Microsoft Outlook</a>
                <button role="menuitem" data-ics="${s.id}">Descargar .ics (Apple/otros)</button>
                <a role="menuitem" href="#" data-mailto="${s.id}">Enviarme por correo</a>
              </div>
            </div>
          </div>
        `;
        // ICS / Mail handlers
        card.querySelector(`[data-ics="${s.id}"]`).addEventListener("click", ()=>{
          downloadICS(buildICS({uid:s.id,title:subject,start,end,description:body,location:s.location}), `${s.title.replace(/\s+/g,"_")}.ics`);
        });
        card.querySelector(`[data-mailto="${s.id}"]`).addEventListener("click",(e)=>{
          e.preventDefault();
          const email = emailInput.value.trim();
          if(!email){ alert("Escribe tu correo en la caja superior para enviarte el evento."); return; }
          const mail = `mailto:${encodeURIComponent(email)}?subject=${encodeURIComponent("Agregar evento a mi calendario")}&body=${
            encodeURIComponent(`${subject}\n${formatRange(start, tz)}\nDuraciÃ³n: ${s.durationMins} mins\nLugar: ${s.location||"Online"}\nEnlace: ${s.meetingUrl||""}\n\nGoogle Calendar: ${gUrl}\nOutlook: ${oUrl}`)
          }`;
          window.location.href = mail;
        });
        // Dropdown behavior (accesible)
        const btn = card.querySelector(".menu-btn");
        const menu = card.querySelector(".menu");
        function openMenu(){
          btn.setAttribute("aria-expanded","true"); menu.setAttribute("aria-hidden","false");
          const first = menu.querySelector("[role='menuitem']"); first && first.focus();
        }
        function closeMenu(){ btn.setAttribute("aria-expanded","false"); menu.setAttribute("aria-hidden","true"); }
        btn.addEventListener("click", (ev)=>{
          const open = btn.getAttribute("aria-expanded")==="true";
          open ? closeMenu() : openMenu();
          ev.stopPropagation();
        });
        btn.addEventListener("keydown",(e)=>{ if(e.key==="ArrowDown"){ e.preventDefault(); openMenu(); }});
        menu.addEventListener("keydown",(e)=>{
          const items = [...menu.querySelectorAll("[role='menuitem']")];
          const i = items.indexOf(document.activeElement);
          if(e.key==="Escape"){ closeMenu(); btn.focus(); }
          if(e.key==="ArrowDown"){ e.preventDefault(); (items[i+1]||items[0]).focus(); }
          if(e.key==="ArrowUp"){ e.preventDefault(); (items[i-1]||items.at(-1)).focus(); }
        });
        document.addEventListener("click", (e)=>{
          if(!menu.contains(e.target) && e.target!==btn) closeMenu();
        });

        cards.appendChild(card);
      });
    }
    render(sessions);

    /* ========= Filtros, tema, email ========= */
    document.getElementById("search").addEventListener("input",(e)=>{
      const q = e.target.value.toLowerCase();
      const filtered = sessions.filter(s => (s.title+s.dateLabel).toLowerCase().includes(q));
      render(filtered);
    });
    document.getElementById("toggleTheme").addEventListener("click",()=>{
      const root = document.documentElement;
      root.setAttribute("data-theme", root.getAttribute("data-theme")==="light" ? "dark" : "light");
    });
    document.getElementById("saveEmail").addEventListener("click",()=>{
      const val = emailInput.value.trim();
      if(!val){ alert("Escribe un correo vÃ¡lido."); return; }
      localStorage.setItem("lia_user_email", val);
      alert("Correo guardado para â€˜Enviarme por correoâ€™."); 
    });
  </script>
</body>
</html>
